#!/system/bin/sh
# ============================================================================
# Module: Systemless_ImageMagick
# Created by Gozer404
# 	Wrapper script for ImageMagick-7

magisk=$(ls /data/adb/magisk/magisk || ls /sbin/magisk) 2>/dev/null;
MAGISK_VERSION=$($magisk -c | sed 's/-.*//')
case "$MAGISK_VERSION" in
'15.'[1-9]*) # Version 15.1 - 15.9
    MAGIMG=/sbin/.core/img
;;
'16.'[1-9]*) # Version 16.1 - 16.9
    MAGIMG=/sbin/.core/img
;;
'17.'[1-3]*) # Version 17.1 - 17.3
    MAGIMG=/sbin/.core/img
;;
'17.'[4-9]*) # Version 17.4 - 17.9
    MAGIMG=/sbin/.magisk/img
;;
'18.'[0-9]*) # Version 18.x
    MAGIMG=/data/adb/modules
;;
'19.'[0-9a-zA-Z]*) # All versions 19
    MAGIMG=/data/adb/modules
;;
*)
    echo "Unsupported Magisk version: $1"
	exit 1
;;
esac

MAGMOD=$MAGIMG/Systemless_ImageMagick

export TMPDIR=$MAGMOD/tmp
mkdir -p $TMPDIR
chmod 0755 $TMPDIR
export MAGICK_HOME=/system/usr
export ICU_DATA_DIR_PREFIX=$MAGICK_HOME
export LD_LIBRARY_PATH=$MAGICK_HOME/lib

$MAGICK_HOME/bin/magick $*
